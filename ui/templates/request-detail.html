{{ define "request-detail" }}
<div class="flex flex-col h-full overflow-hidden" data-content-type="{{ .ContentType }}">
    <!-- Compact Header -->
    <div class="px-4 py-2 border-b border-slate-800 bg-slate-900/40 flex items-center justify-between shrink-0">
        <div class="flex items-center gap-3 min-w-0">
            <span class="text-xs font-bold {{ if eq .Method "GET" }}text-emerald-500{{ else }}text-brand-400{{ end }} font-mono bg-slate-900/50 px-1.5 py-0.5 rounded border border-slate-800/50">{{ .Method }}</span>
            <span class="text-xs text-slate-200 font-mono truncate max-w-xl">{{ .Path }}</span>
        </div>
        <div class="flex items-center gap-1.5">
            <button class="text-[10px] font-bold text-white bg-brand-600 hover:bg-brand-500 px-2.5 py-1 rounded-md transition-all active:scale-95 flex items-center gap-1.5 shadow-lg shadow-brand-600/5"
                    data-request-id="{{ .ID }}"
                    hx-post=""
                    hx-swap="none"
                    hx-on::before-request="setReplayUrl(this); handleReplayBefore(this)"
                    hx-on::after-request="handleReplayAfter(this)">
                <i class="fas fa-repeat text-[9px]"></i>
                Replay
            </button>
            <button class="text-[10px] font-bold text-white bg-red-600 hover:bg-red-500 px-2.5 py-1 rounded-md transition-all active:scale-95 flex items-center gap-1.5 shadow-lg shadow-red-600/5"
                    data-request-id="{{ .ID }}"
                    data-endpoint-id="{{ .EndpointID }}"
                    hx-delete=""
                    hx-target="body"
                    hx-swap="none"
                    hx-on::before-request="setDeleteRequestUrl(this)"
                    hx-on::after-request="handleDeleteRequest(this)">
                <i class="fas fa-trash-can text-[9px]"></i>
                Delete
            </button>
        </div>
    </div>

    <!-- Scrollable Content -->
    <div class="flex-1 overflow-y-auto custom-scrollbar p-4 space-y-4">
        <!-- Headers -->
        <div>
            <div class="flex items-center justify-between mb-1.5">
                <button onclick="toggleSection('headers-section')" class="text-[10px] font-bold text-slate-500 uppercase tracking-widest flex items-center gap-2 hover:text-slate-400 transition-colors">
                    <i class="fas fa-list-ul text-[9px]"></i>
                    Headers
                    <i id="headers-chevron" class="fas fa-chevron-down text-[7px] transition-transform"></i>
                </button>
                <div class="flex items-center gap-2">
                    <button onclick="toggleHeadersView()" class="text-slate-600 hover:text-brand-400 transition-colors p-1 rounded hover:bg-slate-800" title="Toggle view" id="headers-view-toggle">
                        <i class="fas fa-code text-[10px]"></i>
                    </button>
                    <button onclick="copyHeaders()" class="text-slate-600 hover:text-brand-400 transition-colors p-1 rounded hover:bg-slate-800" title="Copy headers">
                        <i class="far fa-copy text-[10px]"></i>
                    </button>
                </div>
            </div>
            <div id="headers-section" class="bg-slate-950 border border-slate-800 rounded-lg overflow-hidden shadow-xl">
                <!-- JSON View (default) -->
                <div id="headers-json-view" class="relative overflow-auto max-h-[150px] custom-scrollbar">
                    <pre class="text-[11px] font-mono text-slate-300 py-2 px-3 m-0 leading-tight whitespace-pre overflow-x-auto">{{ .HeadersJSON }}</pre>
                </div>
                <!-- List View (hidden by default) -->
                <div id="headers-list-view" class="divide-y divide-slate-800/20 hidden max-h-[150px] overflow-y-auto custom-scrollbar">
                    {{ range $key, $values := .HeadersMap }}
                    <div class="px-3 py-1.5 hover:bg-slate-800/40 transition-colors">
                        <div class="text-[9px] text-slate-500 font-mono font-semibold mb-0.5 uppercase tracking-wider">{{ $key }}</div>
                        <div class="text-[11px] text-brand-300 font-mono break-all leading-tight">{{ index $values 0 }}</div>
                    </div>
                    {{ end }}
                </div>
            </div>
        </div>

        <!-- Body -->
        <div>
            <div class="flex items-center justify-between mb-1.5">
                <button onclick="toggleSection('body-section')" class="text-[10px] font-bold text-slate-500 uppercase tracking-widest flex items-center gap-2 hover:text-slate-400 transition-colors">
                    <i class="fas fa-code text-[9px]"></i>
                    Payload Body
                    <i id="body-chevron" class="fas fa-chevron-down text-[7px] transition-transform"></i>
                </button>
                <div class="flex items-center gap-2">
                    <span class="text-[9px] text-slate-600 bg-slate-900/50 border border-slate-800 px-1.5 py-0.5 rounded font-mono">{{ len .Body }} bytes</span>
                    {{ if .ContentType }}
                    <span class="text-[9px] text-slate-500 bg-slate-900/50 border border-slate-800 px-1.5 py-0.5 rounded font-mono">{{ .ContentType }}</span>
                    {{ end }}
                    {{ if not .IsBinary }}
                    <button onclick="formatBody()" class="text-slate-600 hover:text-brand-400 transition-colors p-1 rounded hover:bg-slate-800" title="Format/Prettify">
                        <i class="fas fa-indent text-[10px]"></i>
                    </button>
                    {{ end }}
                    <button onclick="copyBody()" class="text-slate-600 hover:text-brand-400 transition-colors p-1 rounded hover:bg-slate-800" title="Copy body">
                        <i class="far fa-copy text-[10px]"></i>
                    </button>
                </div>
            </div>
            <div id="body-section" class="bg-slate-950 border border-slate-800 rounded-lg overflow-hidden shadow-xl">
                <!-- Code Editor Content -->
                <div class="relative overflow-auto max-h-[600px] custom-scrollbar">
                    <div class="flex">
                        <!-- Line Numbers -->
                        <div id="line-numbers" class="bg-slate-900/80 text-slate-600 text-[10px] font-mono py-2 px-2 text-right select-none border-r border-slate-800/30 sticky left-0"></div>
                        <!-- Code Content -->
                        {{ if .IsBinary }}
                        <div class="flex-1 py-4 px-4 flex items-center justify-center">
                            <div class="text-center">
                                <i class="fas fa-file-binary text-3xl text-slate-700 mb-2"></i>
                                <p class="text-[10px] text-slate-500 font-mono">Binary content ({{ len .Body }} bytes)</p>
                                <p class="text-[9px] text-slate-600 mt-1">Cannot display binary data</p>
                            </div>
                        </div>
                        {{ else }}
                        <pre id="body-raw" class="flex-1 text-[11px] font-mono py-2 px-3 m-0 leading-normal whitespace-pre overflow-x-auto">{{ if .BodyString }}{{ .BodyString | html }}{{ else }}<span class="text-slate-600 italic">Empty body</span>{{ end }}</pre>
                        {{ end }}
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>
{{ end }}
