{{ define "content" }}
<div class="h-full flex overflow-hidden">
    <!-- Compact Request List -->
    <div class="w-80 lg:w-96 border-r border-slate-800 bg-slate-900/30 flex flex-col shrink-0">
        <div class="p-4 border-b border-slate-800 flex items-center justify-between bg-slate-900/50">
            <span class="text-xs font-bold text-slate-500 uppercase tracking-widest">History</span>
            <span id="request-count" class="text-xs font-mono text-slate-400 bg-slate-800 px-2 py-0.5 rounded border border-slate-700/50">
                {{ len .Requests }}
            </span>
        </div>
        <ul id="request-list" class="flex-1 overflow-y-auto custom-scrollbar divide-y divide-slate-800/50"
            hx-ext="sse" sse-connect="/sse/{{ .Endpoint.ID }}" sse-swap="new-request" hx-swap="afterbegin">
            {{ range .Requests }}
                {{ template "request-item" . }}
            {{ end }}
        </ul>
    </div>

    <!-- Details Area -->
    <div class="flex-1 flex flex-col min-w-0 bg-slate-950">
        <!-- Endpoint Header -->
        <div class="p-4 border-b border-slate-800 flex items-center justify-between gap-4 bg-slate-900/20">
            <div class="flex items-center gap-4 min-w-0">
                <span class="text-xs text-slate-500 font-semibold whitespace-nowrap uppercase tracking-wider">URL</span>
                <div class="flex items-center gap-2 min-w-0">
                    <code class="bg-slate-900 border border-slate-800 text-brand-400 px-3 py-1 rounded text-sm font-mono truncate select-all shadow-inner">https://{{ .Host }}/h/{{ .Endpoint.ID }}</code>
                    <button onclick="navigator.clipboard.writeText('https://{{ .Host }}/h/{{ .Endpoint.ID }}')" class="text-slate-500 hover:text-white transition-colors p-1.5 hover:bg-slate-800 rounded-md">
                        <i class="fas fa-copy text-xs"></i>
                    </button>
                </div>
            </div>
            <div class="flex items-center gap-3 whitespace-nowrap">
                <span class="flex items-center gap-2 px-3 py-1 rounded-full text-xs font-bold bg-emerald-500/10 text-emerald-400 border border-emerald-500/20">
                    <span class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></span>
                    Live Stream
                </span>
            </div>
        </div>

        <!-- Request Detail Placeholder/Content -->
        <div id="request-detail" class="flex-1 overflow-hidden flex flex-col">
            {{ if .FirstRequest }}
                {{ template "request-detail" .FirstRequest }}
            {{ else }}
                <div class="flex-1 flex flex-col items-center justify-center text-slate-600 p-8 text-center bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-slate-900/50 to-transparent">
                    <div class="w-16 h-16 bg-slate-900 border border-slate-800 rounded-2xl flex items-center justify-center mb-6 text-slate-700 shadow-xl opacity-20">
                        <img src="/static/pipehook.svg" class="w-10 h-10 grayscale" alt="PipeHooks">
                    </div>
                    <p class="text-sm font-medium text-slate-500">Waiting for activity on endpoint...</p>
                    <p class="text-xs text-slate-600 mt-2">Send an HTTP request to the URL above to see it here.</p>
                </div>
            {{ end }}
        </div>
    </div>
</div>

<script>
    document.body.addEventListener('htmx:afterSwap', function(evt) {
        if (evt.detail.target.id === 'request-list') {
            const count = document.getElementById('request-count');
            if (count) count.innerText = parseInt(count.innerText) + 1;
        }
    });
</script>
{{ end }}

{{ define "request-item" }}
<li class="group hover:bg-slate-800/40 cursor-pointer transition-all relative border-l-4 border-transparent active:bg-slate-800/60"
    hx-get="/r/{{ .ID }}" hx-target="#request-detail"
    onclick="document.querySelectorAll('#request-list li').forEach(el => el.classList.remove('bg-slate-800/50', 'border-brand-500', 'shadow-inner')); this.classList.add('bg-slate-800/50', 'border-brand-500', 'shadow-inner')">
    <div class="px-4 py-4">
        <div class="flex items-center justify-between mb-2">
            <span class="text-xs font-bold {{ if eq .Method "GET" }}text-emerald-500 bg-emerald-500/10 border-emerald-500/20{{ else }}text-brand-400 bg-brand-500/10 border-brand-500/20{{ end }} font-mono px-2 py-0.5 rounded border">{{ .Method }}</span>
            <span class="text-[10px] text-slate-500 font-mono tracking-tighter">{{ .CreatedAt.Format "15:04:05" }}</span>
        </div>
        <p class="text-sm text-slate-300 font-mono truncate group-hover:text-white transition-colors">{{ .Path }}</p>
        <p class="text-[10px] text-slate-600 font-mono mt-1.5 truncate">{{ .RemoteAddr }}</p>
    </div>
</li>
{{ end }}
